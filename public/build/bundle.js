var app=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function i(t){return"function"==typeof t}function s(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function c(t,n){t.appendChild(n)}function r(t,n,e){t.insertBefore(n,e||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function f(){return l(" ")}function h(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function d(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function p(t,n,e,o){t.style.setProperty(n,e,o?"important":"")}function m(t,n,e){t.classList[e?"add":"remove"](n)}let g;function $(t){g=t}function M(){if(!g)throw new Error("Function called outside component initialization");return g}function w(){const t=M();return(n,e)=>{const o=t.$$.callbacks[n];if(o){const i=function(t,n){const e=document.createEvent("CustomEvent");return e.initCustomEvent(t,!1,!1,n),e}(n,e);o.slice().forEach((n=>{n.call(t,i)}))}}}const v=[],b=[],y=[],_=[],x=Promise.resolve();let k=!1;function O(t){y.push(t)}let E=!1;const I=new Set;function j(){if(!E){E=!0;do{for(let t=0;t<v.length;t+=1){const n=v[t];$(n),C(n.$$)}for($(null),v.length=0;b.length;)b.pop()();for(let t=0;t<y.length;t+=1){const n=y[t];I.has(n)||(I.add(n),n())}y.length=0}while(v.length);for(;_.length;)_.pop()();k=!1,E=!1,I.clear()}}function C(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(O)}}const A=new Set;let P;function S(t,n){t&&t.i&&(A.delete(t),t.i(n))}function q(t,n,e,o){if(t&&t.o){if(A.has(t))return;A.add(t),P.c.push((()=>{A.delete(t),o&&(e&&t.d(1),o())})),t.o(n)}}function G(t,n){q(t,1,1,(()=>{n.delete(t.key)}))}function L(t){t&&t.c()}function N(t,e,s){const{fragment:c,on_mount:r,on_destroy:a,after_update:u}=t.$$;c&&c.m(e,s),O((()=>{const e=r.map(n).filter(i);a?a.push(...e):o(e),t.$$.on_mount=[]})),u.forEach(O)}function z(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function D(t,n){-1===t.$$.dirty[0]&&(v.push(t),k||(k=!0,x.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function F(n,i,s,c,r,u,l=[-1]){const f=g;$(n);const h=i.props||{},d=n.$$={fragment:null,ctx:null,props:u,update:t,not_equal:r,bound:e(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:e(),dirty:l,skip_bound:!1};let p=!1;if(d.ctx=s?s(n,h,((t,e,...o)=>{const i=o.length?o[0]:e;return d.ctx&&r(d.ctx[t],d.ctx[t]=i)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](i),p&&D(n,t)),e})):[],d.update(),p=!0,o(d.before_update),d.fragment=!!c&&c(d.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);d.fragment&&d.fragment.l(t),t.forEach(a)}else d.fragment&&d.fragment.c();i.intro&&S(n.$$.fragment),N(n,i.target,i.anchor),j()}$(f)}class T{$destroy(){z(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const W=(t,n,e)=>{const o=n*(4*e)+4*t;return[o,o+1,o+2,o+3]},B=(t,n,e,o,i)=>{const s=n.data,c=Math.pow(.5,e);let r=0;for(let n=0;n<=2*Math.PI;n+=Math.PI/500){let a=6;const u=t(Math.sin(a*n),0,e,1),l=Math.abs(u[3])*(o/2-20)+20;for(let u=1;u<=l;u+=1){const[l,f,h,d]=t(Math.sin(a*n),u,e,1),p=Math.floor(u*Math.cos(n)*c+o/2),m=Math.floor(i/2-u*Math.sin(n)*c),g=W(p,m,o),[$,M,w,v]=g;s[$]=Math.floor(255*l),s[M]=Math.floor(255*f),s[w]=Math.floor(255*h),r++}}return console.log("count: ",r),n};const R=t=>()=>t,H=t=>1/(1+Math.exp(-t)),J=t=>Math.sin(t);var K=Object.freeze({__proto__:null,input:R,identity:t=>t,sigmoid:H,normal:t=>1/Math.sqrt(2*Math.PI)*Math.exp(-t*t/2),tanh:t=>Math.tanh(t),sine:J,relu:t=>Math.max(0,t),abs:t=>Math.abs(t),square:t=>t*t});const Q=t=>{if(0==t.inputs.length)return t.activation();const n=t.inputs.map(Q);return t.activation(((t,n)=>{let e=0;for(let o=0;o!=t.length;o++)e+=t[o]*n[o];return e})(n,t.weights))};function U(n){let e,i,s,l;return{c(){e=u("div"),i=u("canvas"),d(i,"class","flower-canvas"),d(i,"width",V),d(i,"height",X),d(e,"class","container svelte-1dv5i0g"),p(e,"width",V+"px"),p(e,"height",X+"px"),m(e,"selected",n[1]),m(e,"hover",n[2])},m(t,o){r(t,e,o),c(e,i),n[5](i),s||(l=[h(e,"mouseenter",n[6]),h(e,"mouseleave",n[7]),h(e,"click",n[3])],s=!0)},p(t,[n]){2&n&&m(e,"selected",t[1]),4&n&&m(e,"hover",t[2])},i:t,o:t,d(t){t&&a(e),n[5](null),s=!1,o(l)}}}let V=200,X=200;function Y(t,n,e){let o,i,{genome:s}=n,c=!1,r=!1;var a;a=()=>{i=o.getContext("2d"),i.fillStyle="white",i.fillRect(0,0,V,X);const t=((t,n,e,o)=>{const i=n.getImageData(0,0,e,o);return B(t,i,0,e,o),B(t,i,1,e,o),B(t,i,2,e,o),i})(((t,n)=>{const e=new Map,o=Array();return Object.keys(n).forEach((t=>{const i=n[t];e[t]={...i,inputs:[],weights:[]},i.isOutput&&o.push(e[i.id])})),t.forEach((t=>{e[t.to].inputs.push(e[t.from]),e[t.to].weights.push(t.weight)}),[]),(t,n,i,s)=>(e[1].activation=R(t),e[2].activation=R(n),e[3].activation=R(i),e[4].activation=R(s),o.map(Q))})(s.connections,s.genes),i,V,X);i.putImageData(t,0,0)},M().$$.on_mount.push(a);const u=w();return t.$$set=t=>{"genome"in t&&e(4,s=t.genome)},[o,c,r,t=>{e(1,c=!c),u("click")},s,function(t){b[t?"unshift":"push"]((()=>{o=t,e(0,o)}))},()=>e(2,r=!r),()=>e(2,r=!r)]}class Z extends T{constructor(t){super(),F(this,t,Y,U,s,{genome:4})}}function tt(t,n,e){const o=t.slice();return o[5]=n[e],o}function nt(t,n){let e,o,i;return o=new Z({props:{genome:n[5]}}),o.$on("click",(function(){return n[3](n[5])})),{key:t,first:null,c(){e=l(""),L(o.$$.fragment),this.first=e},m(t,n){r(t,e,n),N(o,t,n),i=!0},p(t,e){n=t;const i={};1&e&&(i.genome=n[5]),o.$set(i)},i(t){i||(S(o.$$.fragment,t),i=!0)},o(t){q(o.$$.fragment,t),i=!1},d(t){t&&a(e),z(o,t)}}}function et(t){let n,e,i,s,h,p,m,g,$,M=[],w=new Map,v=t[0];const b=t=>t[5].id;for(let n=0;n<v.length;n+=1){let e=tt(t,v,n),o=b(e);w.set(o,M[n]=nt(o,e))}return{c(){n=u("div"),e=u("h1"),e.textContent="Flowers!",i=f(),s=u("p"),h=l("Click on two flowers to crossbreed them. Generation "),p=l(t[1]),m=f(),g=u("div");for(let t=0;t<M.length;t+=1)M[t].c();d(g,"class","flower-grid svelte-nddwid"),d(n,"class","container")},m(t,o){r(t,n,o),c(n,e),c(n,i),c(n,s),c(s,h),c(s,p),c(n,m),c(n,g);for(let t=0;t<M.length;t+=1)M[t].m(g,null);$=!0},p(t,[n]){if((!$||2&n)&&function(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}(p,t[1]),5&n){const e=t[0];P={r:0,c:[],p:P},M=function(t,n,e,o,i,s,c,r,a,u,l,f){let h=t.length,d=s.length,p=h;const m={};for(;p--;)m[t[p].key]=p;const g=[],$=new Map,M=new Map;for(p=d;p--;){const t=f(i,s,p),r=e(t);let a=c.get(r);a?o&&a.p(t,n):(a=u(r,t),a.c()),$.set(r,g[p]=a),r in m&&M.set(r,Math.abs(p-m[r]))}const w=new Set,v=new Set;function b(t){S(t,1),t.m(r,l),c.set(t.key,t),l=t.first,d--}for(;h&&d;){const n=g[d-1],e=t[h-1],o=n.key,i=e.key;n===e?(l=n.first,h--,d--):$.has(i)?!c.has(o)||w.has(o)?b(n):v.has(i)?h--:M.get(o)>M.get(i)?(v.add(o),b(n)):(w.add(i),h--):(a(e,c),h--)}for(;h--;){const n=t[h];$.has(n.key)||a(n,c)}for(;d;)b(g[d-1]);return g}(M,n,b,1,t,e,w,g,G,nt,null,tt),P.r||o(P.c),P=P.p}},i(t){if(!$){for(let t=0;t<v.length;t+=1)S(M[t]);$=!0}},o(t){for(let t=0;t<M.length;t+=1)q(M[t]);$=!1},d(t){t&&a(n);for(let t=0;t<M.length;t+=1)M[t].d()}}}function ot(t,n,e){let o,{flowers:i}=n,s=0;const c=t=>{o?o.id===t.id?o=void 0:(console.log("parent1: ",o),console.log("parent2: ",t),e(0,i=o.cross(t,4)),o=void 0,e(1,s++,s)):o=t};return t.$$set=t=>{"flowers"in t&&e(0,i=t.flowers)},[i,s,c,t=>c(t)]}class it extends T{constructor(t){super(),F(this,t,ot,et,s,{flowers:0})}}class st{constructor(){this._id=st.genomeId++,this.mutationProb=.1}get id(){return this._id}clone(){const t=new st;return t.connections=this.connections.map((t=>({...t}))),t.genes=new Map,Object.values(this.genes).forEach((n=>t.genes[n.id]={...n})),t}mutate(){const t=this.clone();return t.mutateWeights(),Math.random()<.5&&t.addConnection(),Math.random()<.3&&t.addGene(),t}mutateWeights(){this.connections.forEach((t=>{Math.random()<this.mutationProb&&(t.weight+=.3*Math.random()-.6)}))}addConnection(){ct(this.connections,this.genes);const t=Object.values(this.genes).map((t=>t.id)),n=t.filter((t=>![5,6,7,8].some((n=>n==t))));let e,o;do{e=n[Math.floor(Math.random()*n.length)];const i=this.connections.filter((t=>t.from==e)).map((t=>t.to));o=Object.values(this.genes).map((t=>t.id)),o=t.filter((t=>!i.some((n=>n==t))&&![1,2,3,4].some((n=>n==t))&&this.genes[t].distance>this.genes[e].distance))}while(0==o.length);const i=o[Math.floor(Math.random()*o.length)];this.connections.push({id:st.connectionId++,from:e,to:i,weight:2*Math.random()-1})}deleteConnection(){}addGene(){const t=Math.floor(Math.random()*this.connections.length),n=this.connections[t].from,e=this.connections[t].to;this.connections.splice(t,1);let o={...K};delete o.input;const i=Object.values(o),s=i[Math.floor(Math.random()*i.length)],c=st.geneId++;return this.genes[c]={id:c,activation:s,isOutput:!1,distance:1},this.connections.push({id:st.connectionId++,from:n,to:c,weight:2*Math.random()-1}),this.connections.push({id:st.connectionId++,from:c,to:e,weight:2*Math.random()-1}),c}cross(t,n){const e=this.clone();for(const n of Object.values(t.genes))e.genes[n.id]={...n};const o=Array(n).fill(e,0,n).map((t=>{const n=t.clone();return n.connections=[],n}));for(const n of t.connections){const t=e.connections.findIndex((t=>t.id===n.id));if(-1!=t){for(const i of o)Math.random()<.5?i.connections.push(e.connections[t]):i.connections.push(n);e.connections.splice(t,1)}else for(const t of o)t.connections.push(n)}return o.forEach((t=>t.connections=t.connections.concat(e.connections))),console.log("children: ",o),o.map((t=>t.mutate()))}}st.genomeId=1,st.geneId=9,st.connectionId=5;const ct=(t,n)=>{const e=[...t],o=new Map;for(o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4];e.length>0;)for(let t=e.length-1;-1!=t;t--){const i=e[t];o[i.from]&&(n[i.to].distance=o[i.from].distance+1,o[i.to]=n[i.to],e.splice(t,1))}},rt=new Map;rt[1]={id:1,activation:()=>.5,isOutput:!1,distance:0},rt[2]={id:2,activation:()=>.6,isOutput:!1,distance:0},rt[3]={id:3,activation:()=>.7,isOutput:!1,distance:0},rt[4]={id:4,activation:()=>.8,isOutput:!1,distance:0},rt[5]={id:5,activation:H,isOutput:!0,distance:1},rt[6]={id:6,activation:H,isOutput:!0,distance:1},rt[7]={id:7,activation:H,isOutput:!0,distance:1},rt[8]={id:8,activation:J,isOutput:!0,distance:1};const at=[{id:1,from:1,to:5,weight:Math.random()-.5},{id:2,from:2,to:6,weight:Math.random()-.5},{id:3,from:3,to:7,weight:Math.random()-.5},{id:4,from:4,to:8,weight:(Math.random()-.5)/2}],ut=new st;function lt(n){let e,o,i;return o=new it({props:{flowers:n[0]}}),{c(){e=u("main"),L(o.$$.fragment),d(e,"class","svelte-1h6otfa")},m(t,n){r(t,e,n),N(o,e,null),i=!0},p:t,i(t){i||(S(o.$$.fragment,t),i=!0)},o(t){q(o.$$.fragment,t),i=!1},d(t){t&&a(e),z(o)}}}function ft(t){return[Array(3).fill(ut).map((t=>t.mutate()))]}ut.connections=at,ut.genes=rt;return new class extends T{constructor(t){super(),F(this,t,ft,lt,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
